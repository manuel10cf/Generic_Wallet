<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for blocktrail-sdk-nodejs/lib/wallet_sweeper.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../prettify.css" />
    <link rel="stylesheet" href="../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../index.html">All files</a> / <a href="index.html">blocktrail-sdk-nodejs/lib</a> wallet_sweeper.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.66% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>21/274</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/152</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/39</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">7.66% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>21/274</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var UnspentOutputFinder = require('./unspent_output_finder');
var bitcoin = require('bitcoinjs-lib');
var bip39 = require("bip39");
var CryptoJS = require('crypto-js');
var blocktrail = require('./blocktrail');
var EncryptionMnemonic = require('./encryption_mnemonic');
var Encryption = require('./encryption');
var walletSDK = require('./wallet');
var _ = require('lodash');
var q = require('q');
var async = require('async');
&nbsp;
/**
 *
 * @param backupData
 * @param bitcoinDataClient
 * @param options
 * @constructor
 */
var WalletSweeper = <span class="fstat-no" title="function not covered" >fu</span>nction(backupData, bitcoinDataClient, options) {
    /* jshint -W071, -W074 */
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
<span class="cstat-no" title="statement not covered" >    this.defaultSettings = {</span>
        network: 'btc',
        testnet: false,
        logging: false,
        bitcoinCash: false,
        sweepBatchSize: 200
    };
<span class="cstat-no" title="statement not covered" >    this.settings = _.merge({}, this.defaultSettings, options);</span>
<span class="cstat-no" title="statement not covered" >    this.bitcoinDataClient = bitcoinDataClient;</span>
<span class="cstat-no" title="statement not covered" >    this.utxoFinder = new UnspentOutputFinder(bitcoinDataClient, this.settings);</span>
<span class="cstat-no" title="statement not covered" >    this.sweepData = null;</span>
&nbsp;
    // set the bitcoinlib network
<span class="cstat-no" title="statement not covered" >    if (typeof options.network === "object") {</span>
<span class="cstat-no" title="statement not covered" >        this.network = options.network;</span>
    } else {
<span class="cstat-no" title="statement not covered" >        this.network = this.getBitcoinNetwork(this.settings.network, this.settings.testnet);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    backupData.walletVersion = backupData.walletVersion || 2; </span>  //default to version 2 wallets
&nbsp;
    var usePassword = <span class="cstat-no" title="statement not covered" >false;</span>
&nbsp;
    // validate backup data, cleanup input, and prepare seeds
<span class="cstat-no" title="statement not covered" >    if (!Array.isArray(backupData.blocktrailKeys)) {</span>
<span class="cstat-no" title="statement not covered" >        throw new Error('blocktrail pub keys are required (must be type Array)');</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    switch (backupData.walletVersion) {</span>
        case 1:
<span class="cstat-no" title="statement not covered" >            if (typeof backupData.primaryMnemonic === "undefined" || !backupData.primaryMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('missing primary mnemonic for version 1 wallet');</span>
            }
<span class="cstat-no" title="statement not covered" >            if (typeof backupData.backupMnemonic === "undefined" || !backupData.backupMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('missing backup mnemonic for version 1 wallet');</span>
            }
<span class="cstat-no" title="statement not covered" >            if (typeof backupData.primaryPassphrase === "undefined") {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('missing primary passphrase for version 1 wallet');</span>
            }
&nbsp;
            // cleanup copy paste errors from mnemonics
<span class="cstat-no" title="statement not covered" >            backupData.primaryMnemonic = backupData.primaryMnemonic.trim()</span>
                .replace(new RegExp("\r\n", 'g'), " ")
                .replace(new RegExp("\n", 'g'), " ")
                .replace(/\s+/g, " ");
<span class="cstat-no" title="statement not covered" >            backupData.backupMnemonic = backupData.backupMnemonic.trim()</span>
                .replace(new RegExp("\r\n", 'g'), " ")
                .replace(new RegExp("\n", 'g'), " ")
                .replace(/\s+/g, " ");
<span class="cstat-no" title="statement not covered" >        break;</span>
&nbsp;
        case 2:
        case 3:
<span class="cstat-no" title="statement not covered" >            if (typeof backupData.encryptedPrimaryMnemonic === "undefined" || !backupData.encryptedPrimaryMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('missing encrypted primary seed for version 2 wallet');</span>
            }
<span class="cstat-no" title="statement not covered" >            if (typeof backupData.backupMnemonic === "undefined" || (!backupData.backupMnemonic &amp;&amp; backupData.backupMnemonic !== false)) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error('missing backup seed for version 2 wallet');</span>
            }
            //can either recover with password and password encrypted secret, or with encrypted recovery secret and a decryption key
<span class="cstat-no" title="statement not covered" >            usePassword = typeof backupData.password !== "undefined" &amp;&amp; backupData.password !== null;</span>
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                if (typeof backupData.passwordEncryptedSecretMnemonic === "undefined" || !backupData.passwordEncryptedSecretMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                    throw new Error('missing password encrypted secret for version 2 wallet');</span>
                }
<span class="cstat-no" title="statement not covered" >                if (typeof backupData.password === "undefined") {</span>
<span class="cstat-no" title="statement not covered" >                    throw new Error('missing primary passphrase for version 2 wallet');</span>
                }
            } else {
<span class="cstat-no" title="statement not covered" >                if (typeof backupData.encryptedRecoverySecretMnemonic === "undefined" || !backupData.encryptedRecoverySecretMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                    throw new Error('missing encrypted recovery secret for version 2 wallet (recovery without password)');</span>
                }
<span class="cstat-no" title="statement not covered" >                if (!backupData.recoverySecretDecryptionKey) {</span>
<span class="cstat-no" title="statement not covered" >                    throw new Error('missing recovery secret decryption key for version 2 wallet (recovery without password)');</span>
                }
            }
&nbsp;
            // cleanup copy paste errors from mnemonics
<span class="cstat-no" title="statement not covered" >            backupData.encryptedPrimaryMnemonic = backupData.encryptedPrimaryMnemonic.trim()</span>
                .replace(new RegExp("\r\n", 'g'), " ")
                .replace(new RegExp("\n", 'g'), " ")
                .replace(/\s+/g, " ");
<span class="cstat-no" title="statement not covered" >            backupData.backupMnemonic = (backupData.backupMnemonic || "").trim()</span>
                .replace(new RegExp("\r\n", 'g'), " ")
                .replace(new RegExp("\n", 'g'), " ")
                .replace(/\s+/g, " ");
<span class="cstat-no" title="statement not covered" >            if (backupData.recoverySecretDecryptionKey) {</span>
<span class="cstat-no" title="statement not covered" >                backupData.recoverySecretDecryptionKey = backupData.recoverySecretDecryptionKey.trim()</span>
                    .replace(new RegExp("\r\n", 'g'), " ")
                    .replace(new RegExp("\n", 'g'), " ")
                    .replace(/\s+/g, " ");
            }
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                backupData.passwordEncryptedSecretMnemonic = backupData.passwordEncryptedSecretMnemonic.trim()</span>
                    .replace(new RegExp("\r\n", 'g'), " ").replace(new RegExp("\n", 'g'), " ").replace(/\s+/g, " ");
            } else {
<span class="cstat-no" title="statement not covered" >                backupData.encryptedRecoverySecretMnemonic = backupData.encryptedRecoverySecretMnemonic.trim()</span>
                    .replace(new RegExp("\r\n", 'g'), " ").replace(new RegExp("\n", 'g'), " ").replace(/\s+/g, " ");
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >        break;</span>
&nbsp;
        default:
<span class="cstat-no" title="statement not covered" >            throw new Error('Wrong version [' + backupData.walletVersion + ']');</span>
    }
&nbsp;
&nbsp;
    // create BIP32 HDNodes for the Blocktrail public keys
<span class="cstat-no" title="statement not covered" >    this.blocktrailPublicKeys = {};</span>
<span class="cstat-no" title="statement not covered" >    _.each(backupData.blocktrailKeys, <span class="fstat-no" title="function not covered" >fu</span>nction(blocktrailKey) {</span>
<span class="cstat-no" title="statement not covered" >        self.blocktrailPublicKeys[blocktrailKey['keyIndex']] = bitcoin.HDNode.fromBase58(blocktrailKey['pubkey'], self.network);</span>
    });
&nbsp;
    // convert the primary and backup mnemonics to seeds (using BIP39)
    var primarySeed, backupSeed, secret;
<span class="cstat-no" title="statement not covered" >    switch (backupData.walletVersion) {</span>
        case 1:
<span class="cstat-no" title="statement not covered" >            primarySeed = bip39.mnemonicToSeed(backupData.primaryMnemonic, backupData.primaryPassphrase);</span>
<span class="cstat-no" title="statement not covered" >            backupSeed = bip39.mnemonicToSeed(backupData.backupMnemonic, "");</span>
<span class="cstat-no" title="statement not covered" >        break;</span>
&nbsp;
        case 2:
            // convert mnemonics to hex (bip39) and then base64 for decryption
<span class="cstat-no" title="statement not covered" >            backupData.encryptedPrimaryMnemonic = blocktrail.convert(bip39.mnemonicToEntropy(backupData.encryptedPrimaryMnemonic), 'hex', 'base64');</span>
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                backupData.passwordEncryptedSecretMnemonic = blocktrail.convert(</span>
                    bip39.mnemonicToEntropy(backupData.passwordEncryptedSecretMnemonic), 'hex', 'base64');
            } else {
<span class="cstat-no" title="statement not covered" >                backupData.encryptedRecoverySecretMnemonic = blocktrail.convert(</span>
                    bip39.mnemonicToEntropy(backupData.encryptedRecoverySecretMnemonic), 'hex', 'base64');
            }
&nbsp;
            // decrypt encryption secret
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                secret = CryptoJS.AES.decrypt(backupData.passwordEncryptedSecretMnemonic, backupData.password).toString(CryptoJS.enc.Utf8);</span>
            } else {
<span class="cstat-no" title="statement not covered" >                secret = CryptoJS.AES.decrypt(backupData.encryptedRecoverySecretMnemonic, backupData.recoverySecretDecryptionKey).toString(CryptoJS.enc.Utf8);</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!secret) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error("Could not decrypt secret with " + (usePassword ? "password" : "decryption key"));</span>
            }
&nbsp;
            // now finally decrypt the primary seed and convert to buffer (along with backup seed)
<span class="cstat-no" title="statement not covered" >            primarySeed = new Buffer(CryptoJS.AES.decrypt(backupData.encryptedPrimaryMnemonic, secret).toString(CryptoJS.enc.Utf8), 'base64');</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (backupData.backupMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                backupSeed = new Buffer(bip39.mnemonicToEntropy(backupData.backupMnemonic), 'hex');</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >        break;</span>
&nbsp;
        case 3:
            // convert mnemonics to hex (bip39) and then base64 for decryption
<span class="cstat-no" title="statement not covered" >            backupData.encryptedPrimaryMnemonic = EncryptionMnemonic.decode(backupData.encryptedPrimaryMnemonic);</span>
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                backupData.passwordEncryptedSecretMnemonic = EncryptionMnemonic.decode(backupData.passwordEncryptedSecretMnemonic);</span>
            } else {
<span class="cstat-no" title="statement not covered" >                backupData.encryptedRecoverySecretMnemonic = EncryptionMnemonic.decode(backupData.encryptedRecoverySecretMnemonic);</span>
            }
&nbsp;
            // decrypt encryption secret
<span class="cstat-no" title="statement not covered" >            if (usePassword) {</span>
<span class="cstat-no" title="statement not covered" >                secret = Encryption.decrypt(backupData.passwordEncryptedSecretMnemonic, new Buffer(backupData.password));</span>
            } else {
<span class="cstat-no" title="statement not covered" >                secret = Encryption.decrypt(backupData.encryptedRecoverySecretMnemonic, new Buffer(backupData.recoverySecretDecryptionKey, 'hex'));</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (!secret) {</span>
<span class="cstat-no" title="statement not covered" >                throw new Error("Could not decrypt secret with " + (usePassword ? "password" : "decryption key"));</span>
            }
&nbsp;
            // now finally decrypt the primary seed and convert to buffer (along with backup seed)
<span class="cstat-no" title="statement not covered" >            primarySeed = Encryption.decrypt(backupData.encryptedPrimaryMnemonic, secret);</span>
<span class="cstat-no" title="statement not covered" >            if (backupData.backupMnemonic) {</span>
<span class="cstat-no" title="statement not covered" >                backupSeed = new Buffer(bip39.mnemonicToEntropy(backupData.backupMnemonic), 'hex');</span>
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >        break;</span>
&nbsp;
        default:
<span class="cstat-no" title="statement not covered" >            throw new Error('Wrong version [' + backupData.walletVersion + ']');</span>
    }
&nbsp;
    // convert the primary and backup seeds to private keys (using BIP32)
<span class="cstat-no" title="statement not covered" >    this.primaryPrivateKey = bitcoin.HDNode.fromSeedBuffer(primarySeed, this.network);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (backupSeed) {</span>
<span class="cstat-no" title="statement not covered" >        this.backupPrivateKey = bitcoin.HDNode.fromSeedBuffer(backupSeed, this.network);</span>
<span class="cstat-no" title="statement not covered" >        this.backupPublicKey = this.backupPrivateKey.neutered();</span>
    } else {
<span class="cstat-no" title="statement not covered" >        this.backupPrivateKey = false;</span>
<span class="cstat-no" title="statement not covered" >        this.backupPublicKey = bitcoin.HDNode.fromBase58(backupData.backupPublicKey, this.network);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (this.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >        console.log('using password method: ' + usePassword);</span>
<span class="cstat-no" title="statement not covered" >        console.log("Primary Prv Key: " + this.primaryPrivateKey.toBase58());</span>
<span class="cstat-no" title="statement not covered" >        console.log("Primary Pub Key: " + this.primaryPrivateKey.neutered().toBase58());</span>
<span class="cstat-no" title="statement not covered" >        console.log("Backup Prv Key: " + (this.backupPrivateKey ? this.backupPrivateKey.toBase58() : null));</span>
<span class="cstat-no" title="statement not covered" >        console.log("Backup Pub Key: " + this.backupPublicKey.toBase58());</span>
    }
};
&nbsp;
&nbsp;
/**
 * returns an appropriate bitcoin-js lib network
 *
 * @param network
 * @param testnet
 * @returns {*[]}
 */
WalletSweeper.prototype.getBitcoinNetwork =  <span class="fstat-no" title="function not covered" >fu</span>nction(network, testnet) {
<span class="cstat-no" title="statement not covered" >    switch (network.toLowerCase()) {</span>
        case 'btc':
        case 'bitcoin':
<span class="cstat-no" title="statement not covered" >            if (testnet) {</span>
<span class="cstat-no" title="statement not covered" >                return bitcoin.networks.testnet;</span>
            } else {
<span class="cstat-no" title="statement not covered" >                return bitcoin.networks.bitcoin;</span>
            }
<span class="cstat-no" title="statement not covered" >        break;</span>
        case 'tbtc':
        case 'bitcoin-testnet':
<span class="cstat-no" title="statement not covered" >            return bitcoin.networks.testnet;</span>
        default:
<span class="cstat-no" title="statement not covered" >            throw new Error("Unknown network " + network);</span>
    }
};
&nbsp;
/**
 * gets the blocktrail pub key for the given path from the stored array of pub keys
 *
 * @param path
 * @returns {boolean}
 */
WalletSweeper.prototype.getBlocktrailPublicKey = <span class="fstat-no" title="function not covered" >fu</span>nction(path) {
<span class="cstat-no" title="statement not covered" >    path = path.replace("m", "M");</span>
    var keyIndex = <span class="cstat-no" title="statement not covered" >path.split("/")[1].replace("'", "");</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (!this.blocktrailPublicKeys[keyIndex]) {</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("Wallet.getBlocktrailPublicKey keyIndex (" + keyIndex + ") is unknown to us");</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    return this.blocktrailPublicKeys[keyIndex];</span>
};
&nbsp;
/**
 * generate multisig address and redeem script for given path
 *
 * @param path
 * @returns {{address: *, redeemScript: *}}
 */
WalletSweeper.prototype.createAddress = <span class="fstat-no" title="function not covered" >fu</span>nction(path) {
    //ensure a public path is used
<span class="cstat-no" title="statement not covered" >    path = path.replace("m", "M");</span>
    var keyIndex = <span class="cstat-no" title="statement not covered" >path.split("/")[1].replace("'", "");</span>
    var scriptType = <span class="cstat-no" title="statement not covered" >parseInt(path.split("/")[2]);</span>
&nbsp;
    //derive the primary pub key directly from the primary priv key
    var primaryPubKey = <span class="cstat-no" title="statement not covered" >walletSDK.deriveByPath(this.primaryPrivateKey, path, "m");</span>
    //derive the backup pub key directly from the backup priv key (unharden path)
    var backupPubKey = <span class="cstat-no" title="statement not covered" >walletSDK.deriveByPath(this.backupPublicKey, path.replace("'", ""), "M");</span>
    //derive a pub key for this path from the blocktrail pub key
    var blocktrailPubKey = <span class="cstat-no" title="statement not covered" >walletSDK.deriveByPath(this.getBlocktrailPublicKey(path), path, "M/" + keyIndex + "'");</span>
&nbsp;
    //sort the keys and generate a multisig redeem script and address
    var multisigKeys = <span class="cstat-no" title="statement not covered" >walletSDK.sortMultiSigKeys([</span>
        primaryPubKey.keyPair.getPublicKeyBuffer(),
        backupPubKey.keyPair.getPublicKeyBuffer(),
        blocktrailPubKey.keyPair.getPublicKeyBuffer()
    ]);
&nbsp;
    var multisig = <span class="cstat-no" title="statement not covered" >bitcoin.script.multisig.output.encode(2, multisigKeys);</span>
    var redeemScript, witnessScript;
<span class="cstat-no" title="statement not covered" >    if (this.network !== "bitcoincash" &amp;&amp; scriptType === walletSDK.CHAIN_BTC_SEGWIT) {</span>
<span class="cstat-no" title="statement not covered" >        witnessScript = multisig;</span>
<span class="cstat-no" title="statement not covered" >        redeemScript = bitcoin.script.witnessScriptHash.output.encode(bitcoin.crypto.sha256(witnessScript));</span>
    } else {
<span class="cstat-no" title="statement not covered" >        witnessScript = null;</span>
<span class="cstat-no" title="statement not covered" >        redeemScript = multisig;</span>
    }
    var scriptHash = <span class="cstat-no" title="statement not covered" >bitcoin.crypto.hash160(redeemScript);</span>
    var scriptPubKey = <span class="cstat-no" title="statement not covered" >bitcoin.script.scriptHash.output.encode(scriptHash);</span>
&nbsp;
    var network = <span class="cstat-no" title="statement not covered" >this.network;</span>
<span class="cstat-no" title="statement not covered" >    if (typeof this.network !== "undefined") {</span>
<span class="cstat-no" title="statement not covered" >        network = this.network;</span>
    }
    var address = <span class="cstat-no" title="statement not covered" >bitcoin.address.fromOutputScript(scriptPubKey, network);</span>
&nbsp;
    //@todo return as buffers
<span class="cstat-no" title="statement not covered" >    return {address: address.toString(), redeem: redeemScript, witness: witnessScript};</span>
};
&nbsp;
/**
 * create a batch of multisig addresses
 *
 * @param start
 * @param count
 * @param keyIndex
 * @param chain
 * @returns {{}}
 */
WalletSweeper.prototype.createBatchAddresses = <span class="fstat-no" title="function not covered" >fu</span>nction(start, count, keyIndex, chain) {
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
    var addresses = <span class="cstat-no" title="statement not covered" >{};</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    return q.all(_.range(0, count).map(<span class="fstat-no" title="function not covered" >fu</span>nction(i) {</span>
        //create a path subsequent address
        var path =  <span class="cstat-no" title="statement not covered" >"M/" + keyIndex + "'/" + chain + "/" + (start + i);</span>
        var multisig = <span class="cstat-no" title="statement not covered" >self.createAddress(path);</span>
<span class="cstat-no" title="statement not covered" >        addresses[multisig['address']] = {</span>
            redeem: multisig['redeem'],
            witness: multisig['witness'],
            path: path
        };
    })).then(<span class="fstat-no" title="function not covered" >fu</span>nction() {
<span class="cstat-no" title="statement not covered" >        return addresses;</span>
    });
};
&nbsp;
WalletSweeper.prototype.discoverWalletFunds = <span class="fstat-no" title="function not covered" >fu</span>nction(increment, cb) {
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
    var totalBalance = <span class="cstat-no" title="statement not covered" >0;</span>
    var totalUTXOs = <span class="cstat-no" title="statement not covered" >0;</span>
    var totalAddressesGenerated = <span class="cstat-no" title="statement not covered" >0;</span>
    var addressUTXOs = <span class="cstat-no" title="statement not covered" >{};</span>    //addresses and their utxos, paths and redeem scripts
<span class="cstat-no" title="statement not covered" >    if (typeof increment === "undefined") {</span>
<span class="cstat-no" title="statement not covered" >        increment = this.settings.sweepBatchSize;</span>
    }
&nbsp;
    var deferred = <span class="cstat-no" title="statement not covered" >q.defer();</span>
<span class="cstat-no" title="statement not covered" >    deferred.promise.nodeify(cb);</span>
&nbsp;
    var checkChain;
<span class="cstat-no" title="statement not covered" >    if (this.network === "bitcoincash") {</span>
<span class="cstat-no" title="statement not covered" >        checkChain = [0, 1];</span>
    } else {
<span class="cstat-no" title="statement not covered" >        checkChain = [0, 1, 2];</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    async.nextTick(<span class="fstat-no" title="function not covered" >fu</span>nction() {</span>
        //for each blocktrail pub key, do fund discovery on batches of addresses
<span class="cstat-no" title="statement not covered" >        async.eachSeries(Object.keys(self.blocktrailPublicKeys), <span class="fstat-no" title="function not covered" >fu</span>nction(keyIndex, done) {</span>
<span class="cstat-no" title="statement not covered" >            async.eachSeries(checkChain, <span class="fstat-no" title="function not covered" >fu</span>nction(chain, done) {</span>
                var i = <span class="cstat-no" title="statement not covered" >0;</span>
                var hasTransactions = <span class="cstat-no" title="statement not covered" >false;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                async.doWhilst(<span class="fstat-no" title="function not covered" >fu</span>nction(done) {</span>
                    //do
<span class="cstat-no" title="statement not covered" >                    if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                        console.log("generating addresses " + i + " -&gt; " + (i + increment) + " using blocktrail key index: " + keyIndex + ", chain: " + chain);</span>
                    }
<span class="cstat-no" title="statement not covered" >                    deferred.notify({</span>
                        message: "generating addresses " + i + " -&gt; " + (i + increment) + "",
                        increment: increment,
                        btPubKeyIndex: keyIndex,
                        chain: chain,
                        //addresses: [],
                        totalAddresses: totalAddressesGenerated,
                        addressUTXOs: addressUTXOs,
                        totalUTXOs: totalUTXOs,
                        totalBalance: totalBalance
                    });
&nbsp;
<span class="cstat-no" title="statement not covered" >                    async.nextTick(<span class="fstat-no" title="function not covered" >fu</span>nction() {</span>
<span class="cstat-no" title="statement not covered" >                        self.createBatchAddresses(i, increment, keyIndex, chain)</span>
                            .then(<span class="fstat-no" title="function not covered" >fu</span>nction(batch) {
<span class="cstat-no" title="statement not covered" >                                totalAddressesGenerated += Object.keys(batch).length;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                                if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                                    console.log("starting fund discovery for " + increment + " addresses...");</span>
                                }
&nbsp;
<span class="cstat-no" title="statement not covered" >                                deferred.notify({</span>
                                    message: "starting fund discovery for " + increment + " addresses",
                                    increment: increment,
                                    btPubKeyIndex: keyIndex,
                                    //addresses: addresses,
                                    totalAddresses: totalAddressesGenerated,
                                    addressUTXOs: addressUTXOs,
                                    totalUTXOs: totalUTXOs,
                                    totalBalance: totalBalance
                                });
&nbsp;
                                //get the unspent outputs for this batch of addresses
<span class="cstat-no" title="statement not covered" >                                return self.bitcoinDataClient.batchAddressHasTransactions(_.keys(batch)).then(<span class="fstat-no" title="function not covered" >fu</span>nction(_hasTransactions) {</span>
<span class="cstat-no" title="statement not covered" >                                    hasTransactions = _hasTransactions;</span>
<span class="cstat-no" title="statement not covered" >                                    if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                                        console.log("batch " + (hasTransactions ? "has" : "does not have") + " transactions...");</span>
                                    }
&nbsp;
<span class="cstat-no" title="statement not covered" >                                    return q.when(hasTransactions)</span>
                                        .then(<span class="fstat-no" title="function not covered" >fu</span>nction(hasTransactions) {
<span class="cstat-no" title="statement not covered" >                                            if (!hasTransactions) {</span>
<span class="cstat-no" title="statement not covered" >                                                return;</span>
                                            }
&nbsp;
                                            //get the unspent outputs for this batch of addresses
<span class="cstat-no" title="statement not covered" >                                            return self.utxoFinder.getUTXOs(_.keys(batch)).then(<span class="fstat-no" title="function not covered" >fu</span>nction(utxos) {</span>
                                                // save the address utxos, along with relevant path and redeem script
<span class="cstat-no" title="statement not covered" >                                                _.each(utxos, <span class="fstat-no" title="function not covered" >fu</span>nction(outputs, address) {</span>
                                                    var witnessScript = <span class="cstat-no" title="statement not covered" >null;</span>
<span class="cstat-no" title="statement not covered" >                                                    if (typeof batch[address]['witness'] !== 'undefined') {</span>
<span class="cstat-no" title="statement not covered" >                                                        witnessScript = batch[address]['witness'];</span>
&nbsp;
                                                    }
<span class="cstat-no" title="statement not covered" >                                                    addressUTXOs[address] = {</span>
                                                        path: batch[address]['path'],
                                                        redeem: batch[address]['redeem'],
                                                        witness: witnessScript,
                                                        utxos: outputs
                                                    };
&nbsp;
<span class="cstat-no" title="statement not covered" >                                                    totalUTXOs += outputs.length;</span>
&nbsp;
                                                    //add up the total utxo value for all addresses
<span class="cstat-no" title="statement not covered" >                                                    totalBalance = _.reduce(outputs, <span class="fstat-no" title="function not covered" >fu</span>nction(carry, output) {</span>
<span class="cstat-no" title="statement not covered" >                                                        return carry + output['value'];</span>
                                                    }, totalBalance);
&nbsp;
<span class="cstat-no" title="statement not covered" >                                                    if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                                                        console.log("found " + outputs.length + " unspent outputs for address: " + address);</span>
                                                    }
                                                });
&nbsp;
<span class="cstat-no" title="statement not covered" >                                                deferred.notify({</span>
                                                    message: "discovering funds",
                                                    increment: increment,
                                                    btPubKeyIndex: keyIndex,
                                                    totalAddresses: totalAddressesGenerated,
                                                    addressUTXOs: addressUTXOs,
                                                    totalUTXOs: totalUTXOs,
                                                    totalBalance: totalBalance
                                                });
                                            });
                                        })
                                        ;
                                });
                            })
                            .then(
<span class="fstat-no" title="function not covered" >                                fu</span>nction() {
                                    //ready for the next batch
<span class="cstat-no" title="statement not covered" >                                    i += increment;</span>
<span class="cstat-no" title="statement not covered" >                                    async.nextTick(done);</span>
                                },
<span class="fstat-no" title="function not covered" >                                fu</span>nction(err) {
<span class="cstat-no" title="statement not covered" >                                    done(err);</span>
                                }
                            )
                        ;
                    });
                }, <span class="fstat-no" title="function not covered" >fu</span>nction() {
                    //while
<span class="cstat-no" title="statement not covered" >                    return hasTransactions;</span>
                }, <span class="fstat-no" title="function not covered" >fu</span>nction(err) {
                    //all done
<span class="cstat-no" title="statement not covered" >                    if (err) {</span>
<span class="cstat-no" title="statement not covered" >                        console.log("batch complete, but with errors", err.message);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >                        deferred.notify({</span>
                            message: "batch complete, but with errors: " + err.message,
                            error: err,
                            increment: increment,
                            btPubKeyIndex: keyIndex,
                            totalAddresses: totalAddressesGenerated,
                            addressUTXOs: addressUTXOs,
                            totalUTXOs: totalUTXOs,
                            totalBalance: totalBalance
                        });
                    }
                    //ready for next Blocktrail pub key
<span class="cstat-no" title="statement not covered" >                    async.nextTick(done);</span>
                });
            }, <span class="fstat-no" title="function not covered" >fu</span>nction(err) {
<span class="cstat-no" title="statement not covered" >                done(err);</span>
            });
        }, <span class="fstat-no" title="function not covered" >fu</span>nction(err) {
            //callback
<span class="cstat-no" title="statement not covered" >            if (err) {</span>
                //perhaps we should also reject the promise, and stop everything?
<span class="cstat-no" title="statement not covered" >                if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                    console.log("error encountered when discovering funds", err);</span>
                }
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >                console.log("finished fund discovery: " + totalBalance + " Satoshi (in " + totalUTXOs + " outputs) " +</span>
                    "found when searching " + totalAddressesGenerated + " addresses");
            }
&nbsp;
<span class="cstat-no" title="statement not covered" >            self.sweepData = {</span>
                utxos: addressUTXOs,
                count: totalUTXOs,
                balance: totalBalance,
                addressesSearched: totalAddressesGenerated
            };
&nbsp;
            //resolve the promise
<span class="cstat-no" title="statement not covered" >            deferred.resolve(self.sweepData);</span>
        });
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    return deferred.promise;</span>
};
&nbsp;
WalletSweeper.prototype.sweepWallet = <span class="fstat-no" title="function not covered" >fu</span>nction(destinationAddress, cb) {
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
    var deferred = <span class="cstat-no" title="statement not covered" >q.defer();</span>
<span class="cstat-no" title="statement not covered" >    deferred.promise.nodeify(cb);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (self.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >        console.log("starting wallet sweeping to address " + destinationAddress);</span>
    }
&nbsp;
<span class="cstat-no" title="statement not covered" >    q.when(true)</span>
        .then(<span class="fstat-no" title="function not covered" >fu</span>nction() {
<span class="cstat-no" title="statement not covered" >            if (!self.sweepData) {</span>
                //do wallet fund discovery
<span class="cstat-no" title="statement not covered" >                return self.discoverWalletFunds()</span>
                    .progress(<span class="fstat-no" title="function not covered" >fu</span>nction(progress) {
<span class="cstat-no" title="statement not covered" >                        deferred.notify(progress);</span>
                    });
            }
        })
        .then(<span class="fstat-no" title="function not covered" >fu</span>nction() {
<span class="cstat-no" title="statement not covered" >            return self.bitcoinDataClient.estimateFee();</span>
        })
        .then(<span class="fstat-no" title="function not covered" >fu</span>nction(feePerKb) {
<span class="cstat-no" title="statement not covered" >            if (self.sweepData['balance'] === 0) {</span>
                //no funds found
<span class="cstat-no" title="statement not covered" >                deferred.reject("No funds found after searching through " + self.sweepData['addressesSearched'] + " addresses");</span>
<span class="cstat-no" title="statement not covered" >                return deferred.promise;</span>
            }
&nbsp;
            //create and sign the transaction
<span class="cstat-no" title="statement not covered" >            return self.createTransaction(destinationAddress, null, feePerKb, deferred);</span>
        })
        .then(<span class="fstat-no" title="function not covered" >fu</span>nction(r) {
<span class="cstat-no" title="statement not covered" >            deferred.resolve(r);</span>
        }, <span class="fstat-no" title="function not covered" >fu</span>nction(e) {
<span class="cstat-no" title="statement not covered" >            deferred.reject(e);</span>
        });
&nbsp;
<span class="cstat-no" title="statement not covered" >    return deferred.promise;</span>
};
&nbsp;
/**
 * creates a raw transaction from the sweep data
 * @param destinationAddress        the destination address for the transaction
 * @param fee                       a specific transaction fee to use (optional: if null, fee will be estimated)
 * @param feePerKb                  fee per kb (optional: if null, use default value)
 * @param deferred                  a deferred promise object, used for giving progress updates (optional)
 */
WalletSweeper.prototype.createTransaction = <span class="fstat-no" title="function not covered" >fu</span>nction(destinationAddress, fee, feePerKb, deferred) {
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
<span class="cstat-no" title="statement not covered" >    if (this.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >        console.log("Creating transaction to address destinationAddress");</span>
    }
<span class="cstat-no" title="statement not covered" >    if (deferred) {</span>
<span class="cstat-no" title="statement not covered" >        deferred.notify({</span>
            message: "creating raw transaction to " + destinationAddress
        });
    }
&nbsp;
    // create raw transaction
    var rawTransaction = <span class="cstat-no" title="statement not covered" >new bitcoin.TransactionBuilder(this.network);</span>
<span class="cstat-no" title="statement not covered" >    if (this.settings.bitcoinCash) {</span>
<span class="cstat-no" title="statement not covered" >        rawTransaction.enableBitcoinCash();</span>
    }
    var inputs = <span class="cstat-no" title="statement not covered" >[];</span>
<span class="cstat-no" title="statement not covered" >    _.each(this.sweepData['utxos'], <span class="fstat-no" title="function not covered" >fu</span>nction(data, address) {</span>
<span class="cstat-no" title="statement not covered" >        _.each(data.utxos, <span class="fstat-no" title="function not covered" >fu</span>nction(utxo) {</span>
<span class="cstat-no" title="statement not covered" >            rawTransaction.addInput(utxo['hash'], utxo['index']);</span>
<span class="cstat-no" title="statement not covered" >            inputs.push({</span>
                txid:         utxo['hash'],
                vout:         utxo['index'],
                scriptPubKey: utxo['script_hex'],
                value:        utxo['value'],
                address:      address,
                path:         data['path'],
                redeemScript: data['redeem'],
                witnessScript: data['witness']
            });
        });
    });
<span class="cstat-no" title="statement not covered" >    if (!rawTransaction) {</span>
<span class="cstat-no" title="statement not covered" >        throw new Error("Failed to create raw transaction");</span>
    }
&nbsp;
    var sendAmount = <span class="cstat-no" title="statement not covered" >self.sweepData['balance'];</span>
    var outputIdx = <span class="cstat-no" title="statement not covered" >rawTransaction.addOutput(destinationAddress, sendAmount);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (typeof fee === "undefined" || fee === null) {</span>
        //estimate the fee and reduce it's value from the output
<span class="cstat-no" title="statement not covered" >        if (deferred) {</span>
<span class="cstat-no" title="statement not covered" >            deferred.notify({</span>
                message: "estimating transaction fee, based on " + blocktrail.toBTC(feePerKb) + " BTC/kb"
            });
        }
        var calcUtxos = <span class="cstat-no" title="statement not covered" >inputs.map(<span class="fstat-no" title="function not covered" >fu</span>nction(input) {</span>
<span class="cstat-no" title="statement not covered" >            return {</span>
                txid: input.txid,
                vout: input.vout,
                address: input.vout,
                scriptpubkey_hex: input.vout,
                redeem_script: input.redeemScript,
                witness_script: input.witnessScript,
                path: input.path,
                value: input.value
            };
        });
<span class="cstat-no" title="statement not covered" >        fee = walletSDK.estimateVsizeFee(rawTransaction.tx, calcUtxos, feePerKb);</span>
    }
<span class="cstat-no" title="statement not covered" >    rawTransaction.tx.outs[outputIdx].value -= fee;</span>
&nbsp;
    //sign and return the raw transaction
<span class="cstat-no" title="statement not covered" >    if (deferred) {</span>
<span class="cstat-no" title="statement not covered" >        deferred.notify({</span>
            message: "signing transaction"
        });
    }
<span class="cstat-no" title="statement not covered" >    return this.signTransaction(rawTransaction, inputs);</span>
};
&nbsp;
WalletSweeper.prototype.signTransaction = <span class="fstat-no" title="function not covered" >fu</span>nction(rawTransaction, inputs) {
    var self = <span class="cstat-no" title="statement not covered" >this;</span>
<span class="cstat-no" title="statement not covered" >    if (this.settings.logging) {</span>
<span class="cstat-no" title="statement not covered" >        console.log("Signing transaction");</span>
    }
&nbsp;
    var sigHash = <span class="cstat-no" title="statement not covered" >bitcoin.Transaction.SIGHASH_ALL;</span>
<span class="cstat-no" title="statement not covered" >    if (this.settings.bitcoinCash) {</span>
<span class="cstat-no" title="statement not covered" >        sigHash |= bitcoin.Transaction.SIGHASH_BITCOINCASHBIP143;</span>
    }
&nbsp;
    //sign the transaction with the private key for each input
<span class="cstat-no" title="statement not covered" >    _.each(inputs, <span class="fstat-no" title="function not covered" >fu</span>nction(input, index) {</span>
        //create private keys for signing
        var primaryPrivKey =  <span class="cstat-no" title="statement not covered" >walletSDK.deriveByPath(self.primaryPrivateKey, input['path'].replace("M", "m"), "m").keyPair;</span>
<span class="cstat-no" title="statement not covered" >        rawTransaction.sign(index, primaryPrivKey, input['redeemScript'], sigHash, input['value'], input['witnessScript']);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (self.backupPrivateKey) {</span>
            var backupPrivKey = <span class="cstat-no" title="statement not covered" >walletSDK.deriveByPath(self.backupPrivateKey, input['path'].replace("'", "").replace("M", "m"), "m").keyPair;</span>
<span class="cstat-no" title="statement not covered" >            rawTransaction.sign(index, backupPrivKey, input['redeemScript'], sigHash, input['value'], input['witnessScript']);</span>
        }
    });
&nbsp;
<span class="cstat-no" title="statement not covered" >    if (self.backupPrivateKey) {</span>
<span class="cstat-no" title="statement not covered" >        return rawTransaction.build().toHex();</span>
    } else {
<span class="cstat-no" title="statement not covered" >        return rawTransaction.buildIncomplete().toHex();</span>
    }
};
&nbsp;
module.exports = WalletSweeper;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Tue Nov 14 2017 22:01:50 GMT+0100 (CET)
</div>
</div>
<script src="../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../sorter.js"></script>
</body>
</html>
